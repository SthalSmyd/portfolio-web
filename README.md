
#  Next.js Ã— Django Ã— TypeScript - ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªãƒ‡ãƒ¢

ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã¯ã€**Next.js (TypeScript)** ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«ã€**Django REST Framework (DRF)** ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æ¡ç”¨ã—ãŸã€**ãƒ¢ãƒ€ãƒ³ãªåˆ†é›¢å‹æ§‹æˆã®ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**ã§ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯**åˆ¥ãƒ—ãƒ­ã‚»ã‚¹ãƒ»åˆ¥Dockerã‚µãƒ¼ãƒ“ã‚¹ã¨ã—ã¦ç‹¬ç«‹**ã—ã¦å‹•ä½œã—ã€**APIé€šä¿¡ã‚’ä»‹ã—ã¦éåŒæœŸé€£æº**ã™ã‚‹æ§‹æˆã¨ãªã£ã¦ã„ã¾ã™ã€‚  
ã“ã‚Œã«ã‚ˆã‚Šã€é–‹ç™ºãƒ»ä¿å®ˆæ€§ã«å„ªã‚ŒãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆãŒå®Ÿç¾ã§ãã¾ã™ã€‚

---

## ç‰¹å¾´

- âœ… SSRï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ã¨ CSRï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼‰ã®çµ„ã¿åˆã‚ã›
- âœ… TypeScript ã«ã‚ˆã‚‹å‹å®‰å…¨ãªãƒ•ãƒ­ãƒ³ãƒˆå®Ÿè£…
- âœ… APIã¨ã®éåŒæœŸé€šä¿¡ï¼ˆDjango DRFï¼‰
- âœ… Docker ã«ã‚ˆã‚‹ç°¡å˜ãªãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒæ§‹ç¯‰
- âœ… 1å°ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ä¸Šã§ **frontend / backend / db** ã‚’ã‚³ãƒ³ãƒ†ãƒŠå˜ä½ã§å®Œå…¨åˆ†é›¢é‹ç”¨

---

##  é–‹ç™ºç”¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. `.env.local` ã‚’ä½œæˆï¼ˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
ä¾‹ï¼š
```env
# Django
DJANGO_SECRET_KEY=your_secret_key
DJANGO_DEBUG=True
DJANGO_ALLOWED_HOSTS=localhost,127.0.0.1,backend

# DB
POSTGRES_DB=mydb
POSTGRES_USER=user
POSTGRES_PASSWORD=pass

# Next.js API URL
NEXT_PUBLIC_API_URL=http://localhost:8000/api      # CSRç”¨ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥å©ãï¼‰
INTERNAL_API_URL=http://backend:8000/api           # SSRç”¨ï¼ˆNext.jsã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å©ãï¼‰
```
> âš ï¸ `DJANGO_SECRET_KEY` ã«é–¢ã—ã¦ã¯ã€ã‚µãƒ³ãƒ—ãƒ«ç”¨ã®å€¤ã‚’ä»®ã§è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚  
> ã”è‡ªèº«ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ä½¿ç”¨ã™ã‚‹éš›ã¯ã€å¿…ãš `.env.local` ã«ã¦é©åˆ‡ãªã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

#### ç’°å¢ƒå¤‰æ•°ã«ã¤ã„ã¦

æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ `.env.local` ãŠã‚ˆã³ `.env.dev` ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ãŒã€  
è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å€¤ã¯ã™ã¹ã¦ **é–‹ç™ºç”¨ã®ãƒ€ãƒŸãƒ¼å€¤ã¾ãŸã¯ã‚µãƒ³ãƒ—ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³** ã§ã™ã€‚

ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ãƒªã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€æœ¬ç•ªé‹ç”¨æ™‚ã«ã¯ `.env.prod` ç­‰ã§é©åˆ‡ãªå€¤ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

---

### 2.Docker Compose ã§èµ·å‹•ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒï¼‰

```bash
docker compose -f docker-compose.local.yml build
```
```bash
docker compose -f docker-compose.local.yml up -d
```

- `frontend` ã¯ Next.jsï¼ˆ3000ç•ªãƒãƒ¼ãƒˆï¼‰
- `backend` ã¯ Django + DRFï¼ˆ8000ç•ªãƒãƒ¼ãƒˆï¼‰
- `db` ã¯ PostgreSQLï¼ˆ5432ç•ªãƒãƒ¼ãƒˆï¼‰
- `nginx`ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ã§ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã‚‚å¯èƒ½
  
> âœ… èµ·å‹•å®Œäº†å¾Œã€å°‘ã—å¾…ã£ã¦ã‹ã‚‰`localhost:3000`(http://localhost:3000)  ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚

---

### 3.åœæ­¢æ™‚
```bash
docker compose -f docker-compose.local.yml down
```

---

## ğŸ”’ æŠ€è¡“æ§‹æˆ

| Layer | Tech |
|-------|------|
| Frontend | Next.js + React + TypeScript |
| Backend | Django + Django REST Framework |
| ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ | Docker + Docker Compose |
| DB | PostgreSQL |
| Web Server | Nginx + SSL (optional) |

ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã¯ DB ã‚‚ Docker å†…ã§èµ·å‹•ã—ã¦ã„ã¾ã™ãŒã€
æœ¬ç•ªç’°å¢ƒã§ã¯ RDS ã‚„ Cloud SQL ãªã©ã®ãƒãƒãƒ¼ã‚¸ãƒ‰DBã‚µãƒ¼ãƒ“ã‚¹ã«åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€
ã‚ˆã‚Šã‚»ã‚­ãƒ¥ã‚¢ã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªé‹ç”¨ãŒå¯èƒ½ã§ã™ã€‚

---

## ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆä¾‹

```
.
â”œâ”€â”€ frontend/        # Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ backend/         # Django ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”œâ”€â”€ nginx/           # Nginx è¨­å®š & SSL
â”œâ”€â”€ .env.local       # ãƒ­ãƒ¼ã‚«ãƒ«ç”¨ ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ docker-compose.local.yml
â””â”€â”€ README.md
```

---

##  å‚™è€ƒãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«ã¤ã„ã¦
> æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€Nginx ã®ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚„SSLæ§‹æˆãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å«ã¾ã‚Œã¦ã„ã¾ã™ã€‚  
> domain-example.com ãªã©ã®ãƒ‰ãƒ¡ã‚¤ãƒ³åã¯ã™ã¹ã¦ã‚µãƒ³ãƒ—ãƒ«ã§ã‚ã‚Šã€å®Ÿéš›ã®é‹ç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚„è¨¼æ˜æ›¸ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚


---

### âš ï¸ æ³¨æ„ï¼šWindowsã§ç·¨é›†ã™ã‚‹æ–¹ã¸

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ `entrypoint.sh` ã‚„ `wait-for-it.sh` ãªã©ã€**ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ.shï¼‰ãƒ•ã‚¡ã‚¤ãƒ«**ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚  
Windowsç’°å¢ƒã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ãŸå ´åˆã€**æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒ `CRLF` ã«ãªã£ã¦ã—ã¾ã†ã¨ã€Dockerç’°å¢ƒã§å®Ÿè¡Œã‚¨ãƒ©ãƒ¼ã«ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚**

#### âœ… è§£æ±ºç­–ï¼š
- **æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã‚’ LFï¼ˆUnixå½¢å¼ï¼‰ã«å¤‰æ›´**ã—ã¦ãã ã•ã„ã€‚
  - VSCodeãªã‚‰ã€å³ä¸‹ã®ã€ŒCRLFã€â†’ã€ŒLFã€ã«å¤‰æ›´ã—ã¦ä¿å­˜ã™ã‚‹ã ã‘ã§OKã§ã™ï¼

> ç‰¹ã« `entrypoint.sh` ãŒ `no such file or directory` ã«ãªã‚‹å ´åˆã¯ã€æ”¹è¡Œã‚³ãƒ¼ãƒ‰ãŒåŸå› ã®å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚

## ğŸ“‡ ä½œè€…æƒ…å ±

Created with ğŸ’– by Masashi Fujimoto  
GitHub: [https://github.com/SthalSmyd](https://github.com/SthalSmyd)  
ãŠå•ã„åˆã‚ã›ã¯ Issue ã¾ãŸã¯ SNS ã«ã¦ã©ã†ãï¼